<html>


<head>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="d3.v2.js"></script>
<script src="charts/charts.js"></script>
<script src="charts/classification.js"></script>

<script type="text/javascript" id="draw_chart">
"use strict"

   
    function createDiv(id) {
        var chart = document.createElement("div");
        chart.id = "chart" + id;
        return chart;
    }   

    function pickChart(data) {
        var classifier = new Classifier(data);
        var keys = classifier.properties.keys;
        //var chart = charts.bubblechart();
        var chart = classifier.selectChart();
        var charts = classifier.selectCharts();

        //Sort array, highest score first
        charts.sort(function(a, b){ return b[0] - a[0] });


        keys = matchKeys(classifier.getChartProperties(chart.title()).types, classifier.getProperties().types, keys);


       //console.log(classifier.properties);


        if(classifier.properties.dimension === 2) {

            for(var i = 0; i < charts.length; i++) {
                if(charts[i][0] > 0) {
                    var div = createDiv(i);
                    document.getElementById("chart_area").appendChild(div);

                    var current_chart = charts[i][1];
                    d3.select(div)
                        .datum(data)
                      .call(current_chart
                        .label(function(d) { return d[keys[0]]; })
                        .amount(function(d) { return +d[keys[1]]; })
                        .width(300)
                        .height(200) );
                }

            }

           

        } else if (classifier.properties.dimension === 3) {
            
            d3.select("#chart_area")
                .datum(data)
              .call(chart
                .label(function(d) { return d[keys[0]]; })
                .amount(function(d) { return +d[keys[1]]; }) 
                .amount2(function(d) { return +d[keys[2]]; }) );

        }


    }

    //This method got out of hand
    //Match the data type to the keys
    function matchKeys(chartTypes, dataTypes, keys) {
        //Clone input to mess with
        var ct = chartTypes.slice(0); 
        var dt = dataTypes.slice(0);
        var k = keys.slice(0);

        var result = new Array(keys.length);
        for(var i = 0; i < result.length; i++) {
            var type = ct[i];
            for(var j = 0; j < dt.length; j++) {
                if(type === dt[j]) {
                    delete dt[j]
                    result[i] = k[j];
                    delete k[j];
                    break;
                }
            }
        }

        return result;

    }


</script>
</head>


<body>

    <div id="chart_area"></div>


    <script>
        d3.csv("data/edu.csv", pickChart)
       /* d3.csv("data/edu.csv", draw_pie_chart)
        d3.csv("data/single_population.csv", draw_bar_chart2)
        d3.csv("data/single_population.csv", draw_pie_chart2)
        d3.csv("data/date,price.csv", draw_line_chart)*/
        //d3.csv("data/edu.csv", pickChart);
        //d3.csv("data/population_filterd.csv", draw)
    </script>


</body>

</html>
